openapi: 3.1.0
info:
  title: Gebeurtenis Abonnementen API Specificatie
  version: 1.0.0
paths:
  /abonnees:
    post:
      operationId: RegistreerAbonnee
      summary: Registreer een geauthenticeerde afnemer als nieuwe abonnee van BRP API Gebeurtenissen
      responses:
        '201':
          description: Afnemer succesvol geregistreerd als abonnee van BRP API Gebeurtenissen.
        '401':
          $ref: '../problem-details/401-unauthorized-response-v1.yaml#/components/responses/401'
        '409':
          $ref: '../problem-details/409-conflict-response-v1.yaml#/components/responses/409'
        '500':
          $ref: '../problem-details/500-internal-server-error-response-v1.yaml#/components/responses/500'
      security:
        - clientCredentials: []
  /abonnees/mijn/abonnementen:
    post: 
      operationId: Abonnementen
      summary: Abonneer de abonnee op één of meerdere gebeurtenistypen
      requestBody: 
        content:
          application/json:
            schema: 
              $ref: '#/components/schemas/AbonneerOpGebeurtenisTypeCommand'
      responses: 
        '201':
          description: Abonnement(en) succesvol aangemaakt.
        '401':
          $ref: '../problem-details/401-unauthorized-response-v1.yaml#/components/responses/401'
        '500':
          $ref: '../problem-details/500-internal-server-error-response-v1.yaml#/components/responses/500'
      security:
        - clientCredentials: []

components:
  securitySchemes:
    clientCredentials:
      type: oauth2
      flows:
        clientCredentials:
          tokenUrl: http://identityserver:6000/connect/token

  schemas:
    AbonnementenCommand:
      type: object
      properties:
        type:
          type: string
      required:
        - type
      discriminator: 
        propertyName: type
        mapping: 
          AbonneerOpGebeurtenisType: '#/components/schemas/AbonneerOpGebeurtenisTypeCommand'

    AbonneerOpGebeurtenisTypeCommand:
      allOf: 
        - $ref: '#/components/schemas/AbonnementenCommand'
        - type: object
          properties:
            gebeurtenisTypes:
              type: array
              items:
                type: string
                pattern: ^[a-z/-/.]{1,50}$
              description: Lijst van gebeurtenistypen waarop de abonnee zich wil abonneren
            burgerServiceNummers:
              type: array
              items:
                $ref: '../brp/identificatienummers/burgerservicenummer-v1.yaml#/components/schemas/Burgerservicenummer'
              description: Het burgerservicenummer (BSN) van de persoon/personen waarvoor de abonnee gebeurtenissen van de opgegeven type(n) wilt ontvangen
          required:
            - gebeurtenisTypes
